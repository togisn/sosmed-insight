<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instagram-like Feed</title>
    <script src="https://cdn.auth0.com/js/auth0/9.18/auth0.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }
        .card {
            background-color: #fff;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        .card img {
            width: 100%;
            height: auto;
            border-radius: 8px;
        }
        .card h3 {
            margin: 10px 0;
            font-size: 18px;
            color: #333;
        }
        .card p {
            color: #666;
            margin: 5px 0;
        }
        #search-bar {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
    </style>
</head>
<body>

<h1>Person Data - Instagram Feed</h1>

<div id="login-form">
  <h2>Login to Access the Feed</h2>
  <button id="login-btn">Login</button>
</div>

<div id="person-feed" style="display:none;">
  <input type="text" id="search-bar" placeholder="Search by name, description, or location..." />
  <div class="container">
    <!-- Cards will be injected here -->
  </div>
  <button id="logout-btn" style="display:none;">Logout</button>
</div>

<script>
  let auth0Client = null;

  // Initialize Auth0 client function
  async function initializeAuth0() {
    auth0Client = await new auth0.WebAuth({
      domain: 'dev-g026xt2sb8rgpuoo.us.auth0.com',
      clientID: 'zebO2RqotUxq0NZ6E1n9EV6ak4QoiD7F',
      redirectUri: window.location.href,
      responseType: 'token id_token',
      scope: 'openid profile'
    });
  }

  // Function to handle authentication
  function handleAuthentication() {
    auth0Client.parseHash((err, authResult) => {
      if (authResult && authResult.accessToken && authResult.idToken) {
        // Successful login, store tokens in local storage
        localStorage.setItem('accessToken', authResult.accessToken);
        localStorage.setItem('idToken', authResult.idToken);

        // Show feed
        showFeed();
      } else if (err) {
        console.error('Authentication failed: ', err);
      }
    });
  }

  // Show feed function
  function showFeed() {
    document.getElementById('login-form').style.display = 'none';
    document.getElementById('person-feed').style.display = 'block';
    document.getElementById('logout-btn').style.display = 'block';
    displayData();  // Function to display the grid feed
  }

  // Login function
  function login() {
    auth0Client.authorize();
  }

  // Logout function
  function logout() {
    localStorage.removeItem('accessToken');
    localStorage.removeItem('idToken');
    auth0Client.logout({
      returnTo: window.location.href
    });
  }

  // Event listeners for login and logout buttons
  document.getElementById('login-btn').addEventListener('click', login);
  document.getElementById('logout-btn').addEventListener('click', logout);

  // Initialize and handle authentication on page load
  window.onload = async function() {
    await initializeAuth0();
    handleAuthentication();

    // Check for existing tokens
    const accessToken = localStorage.getItem('accessToken');
    const idToken = localStorage.getItem('idToken');

    // If tokens exist, show the feed
    if (accessToken && idToken) {
      showFeed();
    }
  };

  // Sample JSON data
  const personData = [
    {
      "name": "John Doe",
      "image": "https://via.placeholder.com/150",
      "description": "Web Developer",
      "location": "New York, USA"
    },
    {
      "name": "Jane Smith",
      "image": "https://via.placeholder.com/150",
      "description": "Graphic Designer",
      "location": "London, UK"
    },
    {
      "name": "Alice Johnson",
      "image": "https://via.placeholder.com/150",
      "description": "Photographer",
      "location": "Paris, France"
    }
  ];

  // Function to display the data as a grid, with optional filtering
  function displayData(filter = '') {
    const container = document.querySelector('.container');
    
    // Clear any existing content
    container.innerHTML = '';

    // Filter the person data based on the search query
    const filteredData = personData.filter(person => 
      person.name.toLowerCase().includes(filter.toLowerCase()) ||
      person.description.toLowerCase().includes(filter.toLowerCase()) ||
      person.location.toLowerCase().includes(filter.toLowerCase())
    );

    // Loop over the filtered data and create grid items
    filteredData.forEach(person => {
      const card = document.createElement('div');
      card.classList.add('card');
      
      card.innerHTML = `
        <img src="${person.image}" alt="${person.name}">
        <h3>${person.name}</h3>
        <p>${person.description}</p>
        <p><small>${person.location}</small></p>
      `;
      
      container.appendChild(card);
    });
  }

  // Listen for input changes in the search bar and filter the data
  document.getElementById('search-bar').addEventListener('input', (event) => {
    const searchQuery = event.target.value;
    displayData(searchQuery);
  });

</script>

</body>
</html>
